# Use an Ubuntu 18.04 base for our staging server
FROM vm/ubuntu:18.04

# Install Python and necessary tools
RUN apt-get update && apt-get install -y python3 curl

# Install an older version of Node.js that is compatible with Ubuntu 18.04
RUN curl -sL https://deb.nodesource.com/setup_12.x | bash - && \
    apt-get install -y nodejs

# Check Node and npm versions
RUN node -v && npm -v

# Setup working directory
WORKDIR /var/www/html

# Copy the repository contents to the correct directory
COPY . /var/www/html

# Install Puppeteer locally in the project directory
RUN npm install puppeteer@2.1.1

# Run the image load test script
RUN node imageLoadTest.js

# Optional: Start a simple Python web server in the background
RUN BACKGROUND python3 -m http.server 80
EXPOSE WEBSITE http://localhost:80

